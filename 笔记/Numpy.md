# Numpy 数据计算库

## 安装 Numpy

------

#### pip 命令安装：

```python
pip install numpy
```



## 创建数组

------

#### 导包

```python
import numpy as np
```

#### 创建一维数组

```python
a = np.array(列表)
```

#### 创建特定形状的数组

`np.zeros((3, 3))` ：创建一个 3x3 的全零数组。这个函数接受一个元组作为形状参数

`np.ones((2, 2))` ：创建一个 2x2 的全一数组。同样，它也接受一个元组来指定形状

`np.full((2, 2), 7)` ：创建一个 2x2 的数组，所有元素都是 7 。这个函数允许指定填充值

#### 范围数组

`np.arange(10)` ：创建一个从 0 到 9 的一维数组。这个函数类似于Python内置的`range`函数

`np.linspace(0, 10, 5)` ：创建一个 0 到 10 的 5 个元素的等差数列。这个函数允许指定起始值、终止值和元素数量

#### 特定条件数组

`np.eye(3)` ：创建一个 3x3 的单位矩阵，对角线上的元素都是 1 ，其他位置都是 0

`np.diag([1, 2, 3])` ：创建一个对角线为给定列表的方阵

#### 随机数组

`np.random.rand(3, 3)` ：创建一个 3x3 的均匀分布随机数数组

`np.random.randn(3, 3)` ：创建一个 3x3 的标准正态分布随机数数组

#### 重复数组

`np.tile([1, 2], (2, 2))` ：通过重复给定的数组来创建一个新的数组。这里将 [1, 2] 重复 2 次，形成一个 2x2 的数组

#### 使用函数创建

`np.fromfunction(lambda i, j: i + j, (3, 3))` ：通过一个函数来创建数组。这里函数 `lambda i, j: i + j` 定义了数组的元素值，形状为 3x3



## 数组操作

------

### 索引与切片

#### 一维数组

**索引：** `a[i]` 其中 `i` 是整数索引

**切片：** `a[i:j:k]` 其中 `i` 是起始索引， `j` 是结束索引， `k` 是步长

#### 多维数组

**索引：** `a[i, j, ...]` 每个轴都有一个索引

**切片：** `a[i:j:k, l:m:n, ...]` 每个轴都可以有独立的切片

###  形状操作

#### `a.reshape(shape)`

**功能 ：** 改变数组的形状，返回一个新的数组

**参数 `shape` ：** 整数或整数元组，表示新数组的形状。例如 `shape=(2, 3)` 表示新数组应该有两行三列

```python
a = np.array([1, 2, 3, 4, 5, 6])  # 一维数组
a.reshape(2, 3)  # 将数组 a 重新塑形为一个 2 行 3 列的二维数组
-> [[1, 2, 3], [4, 5, 6]]  # 输出结果
```

**使用 `order` ：** 决定数组数据在内存中的存储顺序

-   `order='C'` ：默认值，按行（C语言风格）顺序存储数据

-   `order='F'` ：按列（Fortran风格）顺序存储数据

-   `order='A'` ：如果数组在内存中是按行存储的，则按行顺序；如果按列存储，则按列顺序

-   `order='K'` ：保持数组中元素的顺序不变

```python
# 如果数组 a 是按行存储的
a.reshape(2, 3, order='C')
a.reshape(2, 3, order='A')
-> 将产生相同的结果

# 如果数组 a 是按列存储的
a.reshape(2, 3, order='F')
a.reshape(2, 3, order='A')
-> 将产生相同的结果
```

#### `a.flatten()` 

**功能：** 折叠为一维的数组，返回一个新的数组

```python
a = np.array([[1, 2, 3], [4, 5, 6]])  # 二维数组
a.flatten()  # 将数组 a 转换为一维数组
-> [1, 2, 3, 4, 5, 6] # 输出结果
```

**与 `ravel()` 的区别：** 

-   `a.flatten()` 返回原数组的一个副本，而 `a.ravel()` 返回一个视图（view），这意味着对视图的修改会影响到原数组
-   `a.ravel()` 也接受一个 `order` 参数，可以指定返回的数组是按行（'C'）还是按列（'F'）顺序展开

**使用 `order` 参数：**

-   `flatten` 函数不接受 `order` 参数，它总是按行（C语言风格）顺序展开数组
-   如果需要按列（Fortran风格）顺序展开数组，可以使用 `a.transpose().flatten()`

```python
b = a.transpose().flatten()
-> [1, 4, 2, 5, 3, 6]
```

#### **`a.transpose(axes)`**

**功能：** 返回数组的转置视图，即交换数组的轴，一个新的数组

**参数 `axes` ：** 整数或整数元组，表示要交换的轴。如果未指定，默认为原数组的轴顺序的逆序

```python
a = np.array([[1, 2, 3], [4, 5, 6]])  # 二维数组
-> [[1, 2, 3],
    [4, 5, 6]]
a.transpose()  # 将数组 a 转置
-> [[1, 4], 
    [2, 5], 
    [3, 6]]
```

**与 `T` 的区别：** 

-   `a.transpose()` 返回原数组的转置视图，而 `a.T` 属性直接返回转置视图，是 `a.transpose()` 的快捷方式
-   `a.T` 和 `a.transpose()` 在大多数情况下效果相同，但在处理多于两个轴的数组时， `a.transpose(axes)` 提供更多灵活性

**使用 `axes` 参数：**

-   整数：表示交换的轴号，例如 `a.transpose(1)` 或 `a.transpose(2)` 将交换第一和第二轴
-   整数元组：可以指定多个轴进行交换，例如 `a.transpose((1, 0))` 将交换第一和第二轴

```python
a = np.array([[[1, 2], [3, 4]], [[5, 6], [7, 8]]])  # 三维数组
-> [[[1, 2],
     [3, 4]], 
    
    [[5, 6], 
     [7, 8]]]
a.transpose((2, 1, 0))  # 将数组 a 转置
-> [[[1, 5],
     [2, 6]], 
    
    [[3, 7], 
     [4, 8]]]
```

### 合并

#### `np.concatenate((a, b), axis=0)`

**功能：** 沿着指定轴（默认为0，即第一个轴）将两个或多个数组合并成一个数组，返回一个新的数组

**参数 ：**

-   `a, b, ...` ：要合并的数组
-   `axis` ：整数，表示要合并的轴。例如，`axis=0` 表示沿着行方向合并，`axis=1` 表示沿着列方向合并

```python
a = np.array([[1, 2], [3, 4]])
b = np.array([[5, 6], [7, 8]])  # 两个二维数组
np.concatenate((a, b), axis=0)  # 沿着0轴（行方向）将它们合并
-> [[1, 2], 
    [3, 4], 
    [5, 6], 
    [7, 8]]
```

#### `np.vstack((a, b))`

**功能：** 垂直堆叠两个或多个数组，返回一个新的数组

**参数 `a, b, ...` ：** 要堆叠的数组

```python
a = np.array([[1, 2], [3, 4]])
b = np.array([[5, 6], [7, 8]])  # 两个二维数组
np.vstack((a, b))  # 将它们垂直堆叠
-> [[1, 2], 
    [3, 4], 
    [5, 6], 
    [7, 8]]
```

####  `np.hstack((a, b))`

**功能：** 水平堆叠两个或多个数组，返回一个新的数组

**参数 `a, b, ...` ：** 要堆叠的数组

```python
a = np.array([[1, 2], [3, 4]])
b = np.array([[5, 6], [7, 8]])  # 两个二维数组
np.hstack((a, b))  # 将它们水平堆叠
-> [[1, 2, 5, 6], 
    [3, 4, 7, 8]]
```

**与 `np.concatenate` 的区别：**

-   `np.concatenate` 可以沿任何轴堆叠数组，而 `np.vstack` 和 `np.hstack` 仅用于堆叠行和列
-   `np.concatenate` 的 `axis` 参数用于指定堆叠的轴，而 `np.vstack` 和 `np.hstack` 的堆叠方向是固定的

### 分割

#### `np.split(ary, indices_or_sections, axis=0)`

**功能：** 沿着指定轴将一个数组分割成多个子数组，返回一个包含所有子数组的元组

**参数：**

-   `ary` ：要分割的数组
-   `indices_or_sections` ：整数或整数元组，表示分割点或子数组数量
-   `axis` ：整数，表示分割的轴。例如，`axis=0` 表示沿着行方向分割，`axis=1` 表示沿着列方向分割

```python
ary = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])  # 二维数组
-> [[1, 2, 3], 
    [4, 5, 6], 
    [7, 8, 9]]
np.split(ary, 2, axis=0)  # 沿着 0 轴（行）方向将数组 ary 分割成两个子数组
-> (np.array([[1, 2, 3]]),
    np.array([[4, 5, 6], [7, 8, 9]]))
```

### 数组的复制

#### `a.copy()`

**功能：** 返回数组 `a` 的一个深复制，返回一个新的数组

```python
a = np.array([1, 2, 3])
-> [1, 2, 3]
b = a.copy()  # 创建a的一个深复制
b[0] = 10  # 现在可以安全地修改 b，而不会影响 a
a -> [1, 2, 3]
b -> [10, 2, 3]
```

### 数组的视图和浅复制

**使用场景：** 当需要快速访问数组的一个子集，或者需要进行数据操作，而不需要复制整个数组时

#### `a.view(dtype=None)`

**功能：** 返回数组 `a` 的一个视图，即一个可以查看或操作数组数据的窗口，返回一个新的数组

```python
a = np.array([1, 2, 3])
b = a.view()  # 创建 a 的一个视图
# 现在，b 和 a 共享相同的数据，对 b 的修改会影响 a，反之亦然

# 如果希望将数组 a 的数据类型从整型转换为浮点型，可以这样做：
b = a.view(dtype=float)
b -> [1.0, 2.0, 3.0]
```

#### `a[:, :]`

**功能：** 创建数组 `a` 的列视图的快捷方式

**效果：** 返回一个与原数组共享数据的视图，即一个可以查看或操作数组数据的窗口

```python
a = np.array([[1, 2], [3, 4]])
b = a[:, :]  # 创建a的列视图
# 现在，b和a共享相同的数据，对b的修改会影响a，反之亦然
```

#### `a[:]`

**功能：** 创建数组 `a` 的整个视图

**效果：** 返回一个与原数组共享数据的视图，即一个可以查看或操作数组数据的窗口

```python
a = np.array([1, 2, 3])
b = a[:]  # 创建a的整个视图
# 现在，b和a共享相同的数据，对b的修改会影响a，反之亦然
```

#### 注意事项

-   视图与原数组共享数据，这意味着对视图的修改会影响原数组
-   视图的创建不涉及数据的复制，因此比复制操作更高效
-   视图适用于快速查看或操作数组数据，而不需要复制整个数组

### 数组的广播

#### 广播机制

**功能：** 允许在执行算术运算时，将形状不同的数组作为大小相同的数组来处理

**效果：** 在执行算术运算时，较小的数组会自动扩展以匹配较大数组的形状

**目的：** 简化不同形状数组之间的运算

#### 广播规则

-   广播规则仅在执行算术运算时生效，如加法、减法、乘法等
-   广播不改变数组的原始形状，它只影响数组在运算中的表现
-   广播总是沿着操作的轴（ `axis` ）进行

```python
a = np.array([1, 2, 3])
b = 2
a + b -> [3, 4, 5]
# 这是因为标量 b 被视为与 a 形状相同（都是 1x3 的数组），然后进行逐元素加法
```

#### 注意事项

>   1.   数组在进行广播之前必须具有相同的轴数
>   2.   数组在轴上的长度必须满足广播规则，即所有数组在给定轴上的长度都必须相同，或者其中至少有一个长度为 1

```python
a = np.array([[1, 2], [3, 4]])
b = np.array([5, 6])
a + b -> [[6, 8], 
          [8, 10]]
# b会沿着 0 轴（行）方向广播，使其与 a 具有相同的形状
```

### 数组的迭代

#### `np.nditer(a, flags=['buffered'], op_flags=['readwrite'])`

**功能：** 提供了一种灵活的方式来迭代数组的每个元素，同时支持读取、写入或修改操作。返回一个迭代器对象，可以遍历数组的每个元素

**参数 `a` ：** 要迭代的数组

**参数`flags` ：** 迭代器的行为控制标志

-   `'buffered'` ：使迭代器能够在内存中缓冲数据，减少内存访问次数
-   `'refs_ok'` ：允许迭代器返回对原数组元素的引用，而不是复制
-   `'multi_index'` ：返回元素的多维索引
-   `'zerosize_ok'` ：允许迭代空数组

**参数 `op_flags` ：** 操作控制标志，决定是否可以修改数组

-   `'readwrite'` ：允许在迭代过程中读取和写入数组元素
-   `'readonly'` ：只允许读取数组元素
-   `'writeonly'` ：只允许写入数组元素

```python
a = np.array([[1, 2], [3, 4]])
np.nditer(a, flags=['buffered'], op_flags=['readwrite'])  # 迭代并修改数组中的元素

for x in np.nditer(a, flags=['buffered'], op_flags=['readwrite']):  # 将所有元素乘以 2
    x[...] *= 2
a -> [[2, 4], 
      [6, 8]]
```



##  常用函数

------

#### 数学函数

| 函数                              | 说明                                    |
| --------------------------------- | --------------------------------------- |
| `np.abs(a)`                       | 计算数组 `a` 中所有元素的绝对值         |
| `np.sqrt(a)`                      | 计算数组 `a` 中所有元素的平方根         |
| `np.exp(a)`                       | 计算数组 `a` 中所有元素的指数           |
| `np.log(a)`                       | 计算数组 `a` 中所有元素的自然对数       |
| `np.sin(a), np.cos(a), np.tan(a)` | 分别计算数组 `a` 中所有元素的三角函数值 |

#### 统计函数

| 函数                           | 说明                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| `np.sum(a, axis=None)`         | 计算数组 `a` 中所有元素的累加和，可选参数 `axis` 用于指定累加的轴 |
| `np.mean(a, axis=None)`        | 计算数组 `a` 中所有元素的算术平均值，可选参数 `axis` 用于指定平均的轴 |
| `np.std(a, axis=None, ddof=0)` | 计算数组 `a` 中所有元素的标准差，可选参数 `axis` 用于指定计算的轴， `ddof` 用于指定样本标准差的分母 |

#### 布尔操作

| 函数                        | 说明                                     |
| --------------------------- | ---------------------------------------- |
| `np.all(a)`                 | 判断数组 `a` 中所有元素是否都为 True     |
| `np.any(a)`                 | 判断数组 `a` 中是否有至少一个元素为 True |
| `np.where(condition, x, y)` | 根据 `condition` 的布尔值选择 `x` 或 `y` |

#### 排序和搜索

| 函数                                 | 说明                                                         |
| ------------------------------------ | ------------------------------------------------------------ |
| `np.sort(a)`                         | 对数组 `a` 进行排序                                          |
| `np.argsort(a)`                      | 返回数组 `a` 中元素的排序后的索引                            |
| `np.searchsorted(a, v, side='left')` | 在数组 `a` 中搜索 `v` 的第一个位置，如果 `v` 不在 `a` 中，则返回应插入的位置 |

#### 排序和堆

| 函数                   | 说明                                               |
| ---------------------- | -------------------------------------------------- |
| `np.partition(a, kth)` | 对数组 `a` 进行排序，返回第 `kth` 个最小元素的索引 |
| `np.heapify(a)`        | 将数组 `a` 转换为堆                                |
| `np.heapreplace(a)`    | 从堆中移除最小元素并返回                           |

#### 聚合和窗口函数

| 函数                      | 说明                                |
| ------------------------- | ----------------------------------- |
| `np.sum(a, axis=None)`    | 计算数组 `a` 中所有元素的累加和     |
| `np.mean(a, axis=None)`   | 计算数组 `a` 中所有元素的算术平均值 |
| `np.median(a, axis=None)` | 计算数组 `a` 中所有元素的中位数     |
| `np.min(a, axis=None)`    | 计算数组 `a` 中所有元素的最小值     |
| `np.max(a, axis=None)`    | 计算数组 `a` 中所有元素的最大值     |

#### 集合运算

| 函数                   | 说明               |
| ---------------------- | ------------------ |
| `np.union1d(a, b)`     | 计算两个数组的并集 |
| `np.intersect1d(a, b)` | 计算两个数组的交集 |
| `np.setdiff1d(a, b)`   | 计算两个数组的差   |



## 线性代数

------

#### 矩阵和线性代数

| 函数                    | 说明                                       |
| ----------------------- | ------------------------------------------ |
| `np.dot(a, b)`          | 计算矩阵 `a` 和矩阵 `b` 的点积             |
| `np.matmul(a, b)`       | 计算矩阵 `a` 和矩阵 `b` 的乘积，即矩阵乘法 |
| `np.linalg.inv(a)`      | 计算矩阵 `a` 的逆矩阵                      |
| `np.linalg.det(a)`      | 计算矩阵 `a` 的行列式                      |
| `np.linalg.eig(a)`      | 计算矩阵 `a` 的特征值和特征向量            |
| `np.linalg.solve(a, b)` | 解线性方程组 `a x = b`                     |

#### 向量运算

| 函数                                                     | 说明                                |
| -------------------------------------------------------- | ----------------------------------- |
| `np.dot(a, b)`                                           | 计算向量 `a` 和向量 `b` 的点积      |
| `np.cross(a, b)`                                         | 计算向量 `a` 和向量 `b` 的叉积      |
| `np.linalg.norm(a, ord=None, axis=None, keepdims=False)` | 计算向量 `a` 的范数（长度）         |
| `np.linalg.norm(a, ord=2, axis=None, keepdims=False)`    | 计算向量 `a` 的欧几里得范数（长度） |

#### QR 分解

| 函数              | 说明                  |
| ----------------- | --------------------- |
| `np.linalg.qr(a)` | 计算矩阵 `a` 的QR分解 |

#### 奇异值分

| 函数               | 说明                      |
| ------------------ | ------------------------- |
| `np.linalg.svd(a)` | 计算矩阵 `a` 的奇异值分解 |

#### 特征值和特征向量

| 函数                   | 说明                            |
| ---------------------- | ------------------------------- |
| `np.linalg.eig(a)`     | 计算矩阵 `a` 的特征值和特征向量 |
| `np.linalg.eigvals(a)` | 计算矩阵 `a` 的所有特征值       |

#### 奇异值分解（SVD）

| 函数               | 说明                      |
| ------------------ | ------------------------- |
| `np.linalg.svd(a)` | 计算矩阵 `a` 的奇异值分解 |

#### 正交化

| 函数                        | 说明                                   |
| --------------------------- | -------------------------------------- |
| `np.linalg.qr(a)`           | 计算矩阵 `a` 的QR分解，用于正交化      |
| `np.linalg.gram_schmidt(a)` | 使用 Gram-Schmidt 过程对向量进行正交化 |

#### 最小二乘法

| 函数                    | 说明                                 |
| ----------------------- | ------------------------------------ |
| `np.linalg.lstsq(a, b)` | 使用最小二乘法解线性方程组 `a x = b` |



## 随机数生成

------

#### 均匀分布

| 函数                               | 说明                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| `np.random.rand(d0, d1, ..., dn)`  | 生成一个形状为 `d0 x d1 x ... x dn` 的随机数数组，其中每个元素都在 [0, 1) 范围内 |
| `np.random.randn(d0, d1, ..., dn)` | 生成一个形状为 `d0 x d1 x ... x dn` 的随机数数组，其中每个元素都在标准正态分布（均值为 0 ，方差为 1 ）中 |

#### 整数分布

| 函数                                                      | 说明                                                      |
| --------------------------------------------------------- | --------------------------------------------------------- |
| `np.random.randint(low, high=None, size=None, dtype='l')` | 生成一个随机整数数组，其中每个元素都在 [low, high) 范围内 |

#### 其他分布

| 函数                                              | 说明                               |
| ------------------------------------------------- | ---------------------------------- |
| `np.random.normal(loc=0.0, scale=1.0, size=None)` | 生成一个或多个服从正态分布的随机数 |
| `np.random.uniform(low=0.0, high=1.0, size=None)` | 生成一个或多个服从均匀分布的随机数 |

#### 随机排列

| 函数                       | 说明                                              |
| -------------------------- | ------------------------------------------------- |
| `np.random.permutation(x)` | 生成一个随机排列的数组，其中 `x` 可以是数组或序列 |

#### 随机选择

| 函数                                                   | 说明                                                         |
| ------------------------------------------------------ | ------------------------------------------------------------ |
| `np.random.choice(a, size=None, replace=True, p=None)` | 从序列 `a` 中随机选择元素，可选参数 `size` 指定输出数组的大小， `replace` 表示是否放回， `p` 表示选择的概率分布 |

#### 随机化

| 函数                   | 说明                        |
| ---------------------- | --------------------------- |
| `np.random.shuffle(x)` | 将数组 `x` 中的元素随机排列 |

#### 随机种子

| 函数                   | 说明                                               |
| ---------------------- | -------------------------------------------------- |
| `np.random.seed(seed)` | 设置随机数生成器的种子，用于确保随机数生成的一致性 |



## 高级功能

------

### 文件操作

#### 读取和写入数组

| 函数                 | 说明                                                         |
| -------------------- | ------------------------------------------------------------ |
| `np.save(file, arr)` | 将数组 `arr` 保存到文件 `file` 中，支持多种文件格式，如 NPY、HDF5 等 |
| `np.load(file)`      | 从文件 `file` 中加载数组，支持多种文件格式，如 NPY、HDF5 等  |

#### 从文件中读取数组

| 函数                                                | 说明                                                         |
| --------------------------------------------------- | ------------------------------------------------------------ |
| `np.fromfile(file, dtype=float, count=-1, sep=' ')` | 从文件 `file` 中读取数组， `dtype` 指定数据类型， `count` 指定读取元素的数量， `sep` 指定元素之间的分隔符 |

#### 将数组写入文件

| 函数                    | 说明                                             |
| ----------------------- | ------------------------------------------------ |
| `np.tofile(a, sep=' ')` | 将数组 `a` 写入文件， `sep` 指定元素之间的分隔符 |

```python
import numpy as np
arr = np.array([1, 2, 3, 4, 5])
np.save('my_array.npy', arr)  # 保存数组
loaded_arr = np.load('my_array.npy')  # 加载数组
arr_from_file = np.fromfile('my_data.txt', dtype=float, sep=' ')  # 从文件中读取数组
np.tofile(arr, 'my_data.txt')  # 将数组写入文件
```

### 其他

#### 内存映射

Numpy 可以通过内存映射文件（memory-mapped files）处理超出内存容量的数据。这允许用户访问和操作大型数据集，而不需要将整个数据集加载到内存中。

#### 优化算法

Numpy 提供了用于数值优化和数值计算的函数，如数值积分、优化问题求解等。

#### 并行计算

Numpy 支持并行计算，允许在多核处理器上加速数组操作。这通过 `numpy.vectorize()` 、 `numpy.frompyfunc()` 和 `numpy.ufunc` 等函数实现。

#### C 语言接口

Numpy 提供了与 C 语言的接口，允许从 C 语言中直接操作 Numpy 数组。这通过 `ctypes` 和 `cffi` 库实现。

#### 自定义函数

Numpy 允许用户自定义函数，这些函数可以直接作用于数组。这通过 `numpy.frompyfunc()` 和 `numpy.vectorize()` 实现。

#### 类型转换

Numpy 提供了类型转换的高级函数，如 `np.astype()` 和 `np.can_cast()` ，用于将数组转换为不同的数据类型